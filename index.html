<!DOCTYPE html>
<html lang="zh-TW">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title> å¤©æ°£é å ± ğŸŒ¿</title>
    <link href="https://fonts.googleapis.com/css2?family=Bungee+Inline&family=Noto+Sans+TC:wght@700;900&display=swap"
        rel="stylesheet">
    <script src="https://unpkg.com/vue@3/dist/vue.global.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
        :root {
            --comic-green-dark: #2D5A27;
            /* æ·±å¢¨ç¶ é‚Šæ¡† */
            --comic-green-bright: #7CFF6B;
            /* è¢å…‰ç¶ /çˆ†ç‚¸ç¶  */
            --comic-green-soft: #C8E6C9;
            /* æ·ºè‰ç¶  */
            --paper-white: #F1F8E9;
            /* åç¶ çš„ç™½ */
            --ink-black: #1B2E1A;
            /* æ¥µæ·±ç¶ å¢¨æ°´ */
            --comic-border: 4px solid var(--ink-black);
            --comic-shadow: 6px 6px 0 var(--comic-green-dark);
        }

        body {
            font-family: 'Bungee Inline', 'Noto Sans TC', sans-serif;
            background-color: var(--paper-white);
            background-image: radial-gradient(var(--comic-green-dark) 10%, transparent 10%), radial-gradient(var(--comic-green-dark) 10%, transparent 10%);
            background-size: 25px 25px;
            background-position: 0 0, 12.5px 12.5px;
            padding: 20px;
            display: flex;
            justify-content: center;
        }

        .weather-container {
            width: 100%;
            max-width: 800px;
            background-color: var(--comic-green-bright);
            padding: 30px;
            border: var(--comic-border);
            border-radius: 20px;
            box-shadow: var(--comic-shadow);
            text-align: center;
        }

        .current-forecast {
            background-color: white;
            padding: 20px;
            border: var(--comic-border);
            border-radius: 15px;
            box-shadow: 5px 5px 0 var(--ink-black);
            margin-bottom: 25px;
        }

        .temperature {
            font-size: 5em;
            font-weight: 900;
            color: var(--comic-green-dark);
            text-shadow: 3px 3px 0 var(--comic-green-soft);
        }

        /* åœ–è¡¨å®¹å™¨æ¨£å¼ */
        .chart-section {
            background: white;
            border: var(--comic-border);
            border-radius: 10px;
            padding: 15px;
            margin-bottom: 25px;
            box-shadow: 4px 4px 0 var(--ink-black);
        }

        .future-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
            gap: 15px;
        }

        .future-card {
            background: var(--comic-green-soft);
            padding: 15px;
            border: var(--comic-border);
            border-radius: 10px;
            transition: 0.2s;
        }

        .future-card:hover {
            transform: scale(1.05) rotate(2deg);
            background: white;
        }
    </style>
</head>

<body>
    <div id="app" class="weather-container">
        <h1 style="font-size: 3em; -webkit-text-stroke: 1px var(--ink-black);">å¤©æ°£é å ±</h1>
        <div style="font-size: 1.5em; margin-bottom: 20px; font-weight: 900;">{{ cityName }} å¤©æ°£</div>

        <div v-if="loading">æ­£åœ¨è§€æ¸¬é¢¨å‘...</div>

        <div v-else>
            <div class="current-forecast">
                <div style="font-size: 1.8em; color: var(--comic-green-dark);">{{ mainForecast.weather }}</div>
                <div class="temperature">{{ mainForecast.maxTemp }}Â°C</div>
                <div style="font-weight: 900;">èˆ’é©åº¦ï¼š{{ mainForecast.comfort }}</div>
            </div>

            <div class="chart-section">
                <h3 style="margin-top:0;">æº«åº¦è¶¨å‹¢åˆ†æåœ–</h3>
                <canvas id="tempChart"></canvas>
            </div>

            <div class="future-grid">
                <div v-for="f in futureForecasts" class="future-card">
                    <div style="font-size: 1.2em; font-weight: 900;">{{ getShortTime(f.startTime) }}</div>
                    <div style="font-size: 2.5em;">{{ getWeatherEmoji(f.weather) }}</div>
                    <div style="font-weight: 900;">{{ f.minTemp }}~{{ f.maxTemp }}Â°C</div>
                </div>
            </div>
        </div>
    </div>

    <script>
        const { createApp, ref, onMounted, nextTick } = Vue;

        createApp({
            setup() {
                const cityName = ref('');
                const mainForecast = ref(null);
                const futureForecasts = ref([]);
                const loading = ref(true);

                const getWeatherEmoji = (text) => {
                    if (text.includes('æ™´')) return 'â˜€ï¸';
                    if (text.includes('é›²')) return 'â˜ï¸';
                    if (text.includes('é›¨')) return 'ğŸŒ§ï¸';
                    return 'ğŸƒ';
                };

                const getShortTime = (timeStr) => {
                    const hour = new Date(timeStr).getHours();
                    return hour + ":00";
                };

                // åˆå§‹åŒ–åœ–è¡¨
                const initChart = (data) => {
                    const ctx = document.getElementById('tempChart').getContext('2d');
                    new Chart(ctx, {
                        type: 'line',
                        data: {
                            labels: data.map(f => getShortTime(f.startTime)),
                            datasets: [{
                                label: 'æœ€é«˜æº«åº¦ (Â°C)',
                                data: data.map(f => f.maxTemp),
                                borderColor: '#2D5A27',
                                backgroundColor: 'rgba(124, 255, 107, 0.2)',
                                borderWidth: 4,
                                fill: true,
                                tension: 0.4
                            }]
                        },
                        options: {
                            responsive: true,
                            plugins: { legend: { display: false } },
                            scales: {
                                y: { beginAtZero: false },
                                x: { grid: { display: false } }
                            }
                        }
                    });
                };

                const fetchData = async () => {
                    try {
                        const res = await fetch('https://nutc-web-vic-peng.zeabur.app/api/weather/kaohsiung');
                        const json = await res.json();
                        cityName.value = json.data.city;
                        mainForecast.value = json.data.forecasts[0];
                        futureForecasts.value = json.data.forecasts;

                        loading.value = false;

                        // ç­‰å¾… Vue æ¸²æŸ“å®Œ DOM å¾Œå†åˆå§‹åŒ–åœ–è¡¨
                        await nextTick();
                        initChart(json.data.forecasts);
                    } catch (e) {
                        console.error("è³‡æ–™ç²å–å¤±æ•—");
                    }
                };

                onMounted(fetchData);

                return { cityName, mainForecast, futureForecasts, loading, getWeatherEmoji, getShortTime };
            }
        }).mount('#app');
    </script>
</body>

</html>